<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Scientific Calculator - Quantika</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <!-- Three.js CDN for 3D graphics -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
  <style>
    body {
      font-family: 'Inter', sans-serif;
      margin: 0;
      padding: 0;
      overflow: hidden;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
    }

    /* Style for the video background */
    #video-bg {
        position: fixed;
        right: 0;
        bottom: 0;
        min-width: 100%;
        min-height: 100%;
        width: auto;
        height: auto;
        z-index: -100;
        background-size: cover;
    }
    
    .video-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.6);
      z-index: -1;
    }

    .calculator-container {
      width: 100%;
      max-width: 450px;
      padding: 1.5rem;
      background-color: rgba(30, 30, 50, 0.9);
      backdrop-filter: blur(10px);
      border-radius: 1.5rem;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
      border: 2px solid #00BFFF;
      position: relative;
      z-index: 1;
    }

    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding-bottom: 1rem;
    }

    .logo {
      font-size: 1.5rem;
      font-weight: 700;
      color: #00BFFF;
      text-transform: uppercase;
    }

    .home-btn {
      background-color: rgba(0, 191, 255, 0.2);
      color: #00BFFF;
      border: none;
      padding: 0.5rem 1rem;
      border-radius: 0.75rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s ease-in-out;
    }

    .home-btn:hover {
      background-color: rgba(0, 191, 255, 0.4);
      transform: scale(1.05);
    }

    .display {
      background-color: #2c2c44;
      padding: 1rem;
      border-radius: 1rem;
      margin-bottom: 1.5rem;
      height: 120px;
      display: flex;
      flex-direction: column;
      justify-content: flex-end;
      align-items: flex-end;
      box-shadow: inset 0 2px 5px rgba(0, 0, 0, 0.3);
      overflow: hidden;
    }

    #history-display {
      font-size: 1rem;
      color: #888;
      height: 25px;
      white-space: nowrap;
      overflow-x: auto;
    }

    #result-display {
      font-size: 2.5rem;
      color: #fff;
      font-weight: 600;
      line-height: 1;
      white-space: nowrap;
      overflow-x: auto;
    }

    .buttons-grid {
      display: grid;
      grid-template-columns: repeat(5, 1fr);
      gap: 0.75rem;
    }

    .btn {
      background-color: #3b3b5c;
      color: #fff;
      padding: 1rem;
      font-size: 1rem;
      border-radius: 1rem;
      cursor: pointer;
      transition: background-color 0.2s, transform 0.2s, box-shadow 0.2s;
      display: flex;
      justify-content: center;
      align-items: center;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
      user-select: none;
      -webkit-user-select: none;
      -ms-user-select: none;
    }

    .btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 10px rgba(0, 0, 0, 0.4);
    }

    /* Specific button colors and styles */
    .btn-blue {
      background-color: #0077c2;
      color: #fff;
    }

    .btn-blue:hover {
      background-color: #005f9b;
    }

    .btn-operator {
      background-color: #38c172;
      color: #fff;
    }

    .btn-operator:hover {
      background-color: #2ca45c;
    }

    .btn-equals {
      grid-column: span 2;
      background-color: #ff6347;
      color: #fff;
      font-size: 1.2rem;
    }

    .btn-equals:hover {
      background-color: #e5533d;
    }

    .btn-ac {
      background-color: #c0392b;
      color: #fff;
    }

    .btn-ac:hover {
      background-color: #a72f23;
    }

    .btn-sci {
      background-color: #2a2a3e;
      color: #00BFFF;
    }

    .btn-sci:hover {
      background-color: #1f1f2e;
    }

    /* Responsive adjustments */
    @media (max-width: 768px) {
      .calculator-container {
        width: 95%;
        max-width: none;
        padding: 1rem;
      }

      .buttons-grid {
        grid-template-columns: repeat(4, 1fr);
        gap: 0.5rem;
      }

      .btn-equals {
        grid-column: span 1;
      }

      .btn,
      .btn-equals {
        font-size: 0.8rem;
        padding: 0.5rem;
      }

      #history-display {
        font-size: 0.8rem;
      }

      #result-display {
        font-size: 1.8rem;
      }

      .logo {
        font-size: 1.2rem;
      }

      .home-btn {
        padding: 0.4rem 0.8rem;
        font-size: 0.8rem;
      }
    }
    
    /* 3D canvas for the butterfly */
    #three-canvas {
        position: fixed;
        top: 0;
        left: 0;
        width: 100vw;
        height: 100vh;
        z-index: -95;
        display: block;
    }
  </style>
</head>

<body>
  <!-- Video Background -->
  <video autoplay muted loop id="video-bg">
    <source src="video.mp4" type="video/mp4">
    Your browser does not support the video tag.
  </video>
  <div class="video-overlay"></div>
  
  <!-- 3D Canvas -->
  <canvas id="three-canvas"></canvas>

  <!-- Calculator Interface -->
  <div class="calculator-container">
    <header class="header">
      <div class="logo">QUANTIKA</div>
      <a href="index.html" class="home-btn">HOME</a>
    </header>

    <!-- Display Screen -->
    <div class="display">
      <div id="history-display"></div>
      <div id="result-display">0</div>
    </div>

    <!-- Buttons Grid -->
    <div class="buttons-grid">
      <!-- New scientific and memory buttons -->
      <button class="btn btn-sci" data-value="pi">π</button>
      <button class="btn btn-sci" data-value="e">e</button>
      <button class="btn btn-sci" data-function="m_add">M+</button>
      <button class="btn btn-sci" data-function="m_sub">M-</button>
      <button class="btn btn-sci" data-function="m_rec">MR</button>

      <button class="btn btn-sci" data-function="log">log</button>
      <button class="btn btn-sci" data-function="ln">ln</button>
      <button class="btn btn-sci" data-function="ten_pow">10^x</button>
      <button class="btn btn-sci" data-function="e_pow">e^x</button>
      <button class="btn btn-sci" data-function="fact">n!</button>

      <button class="btn btn-sci" data-function="x_sq">x²</button>
      <button class="btn btn-sci" data-function="x_cub">x³</button>
      <button class="btn btn-sci" data-value="(">(</button>
      <button class="btn btn-sci" data-value=")">)</button>
      <button class="btn btn-sci" data-function="nth_root">y√x</button>

      <button class="btn btn-ac" data-function="clear">AC</button>
      <button class="btn btn-operator" data-function="backspace">DEL</button>
      <button class="btn btn-operator" data-function="percent">%</button>
      <button class="btn btn-operator" data-value="/">/</button>
      <button class="btn btn-operator" data-value="*">*</button>

      <button class="btn btn-blue" data-function="sin">sin</button>
      <button class="btn btn-blue" data-function="asin">asin</button>
      <button class="btn" data-value="7">7</button>
      <button class="btn" data-value="8">8</button>
      <button class="btn" data-value="9">9</button>

      <button class="btn btn-blue" data-function="cos">cos</button>
      <button class="btn btn-blue" data-function="acos">acos</button>
      <button class="btn" data-value="4">4</button>
      <button class="btn" data-value="5">5</button>
      <button class="btn" data-value="6">6</button>

      <button class="btn btn-blue" data-function="tan">tan</button>
      <button class="btn btn-blue" data-function="atan">atan</button>
      <button class="btn" data-value="1">1</button>
      <button class="btn" data-value="2">2</button>
      <button class="btn" data-value="3">3</button>

      <button class="btn btn-blue" data-function="sqrt">√</button>
      <button class="btn btn-blue" data-function="cbrt">³√</button>
      <button class="btn" data-value="0">0</button>
      <button class="btn" data-value=".">.</button>
      <button class="btn" data-function="pow_y">x^y</button>

      <button class="btn btn-operator" data-value="+">+</button>
      <button class="btn btn-operator" data-value="-">-</button>
      <button class="btn btn-equals" data-function="equals">=</button>
    </div>
  </div>

  <script>
    const historyDisplay = document.getElementById('history-display');
    const resultDisplay = document.getElementById('result-display');
    const buttonsGrid = document.querySelector('.buttons-grid');

    let currentInput = '';
    let memory = 0;

    // Helper function for factorial calculation
    function fact(n) {
      if (n < 0) throw new Error('Factorial of negative number is undefined');
      if (n === 0) return 1;
      let result = 1;
      for (let i = 2; i <= n; i++) {
        result *= i;
      }
      return result;
    }

    // Helper function for degrees to radians conversion
    function toRad(degrees) {
      return degrees * (Math.PI / 180);
    }

    // Helper function for radians to degrees conversion
    function toDeg(radians) {
      return radians * (180 / Math.PI);
    }

    // Function to handle all button clicks and keyboard input
    function handleInput(input) {
      const value = input;
      const func = buttonsGrid.querySelector(`[data-value="${value}"], [data-function="${value}"]`)?.dataset.function || value;

      if (/[0-9\.\+\-\*\/\(\)]/.test(value)) {
        currentInput += value;
      } else if (func) {
        switch (func) {
          case 'clear':
            currentInput = '';
            resultDisplay.textContent = '0';
            historyDisplay.textContent = '';
            break;
          case 'backspace':
          case 'DEL':
            currentInput = currentInput.slice(0, -1);
            if (currentInput === '') {
              resultDisplay.textContent = '0';
            }
            break;
          case 'equals':
          case '=':
            evaluateExpression();
            return;
          case 'sin':
            currentInput += 'sin(';
            break;
          case 'asin':
            currentInput += 'asin(';
            break;
          case 'cos':
            currentInput += 'cos(';
            break;
          case 'acos':
            currentInput += 'acos(';
            break;
          case 'tan':
            currentInput += 'tan(';
            break;
          case 'atan':
            currentInput += 'atan(';
            break;
          case 'log':
            currentInput += 'log(';
            break;
          case 'ln':
            currentInput += 'ln(';
            break;
          case 'ten_pow':
            currentInput += '10**(';
            break;
          case 'e_pow':
            currentInput += 'Math.E**(';
            break;
          case 'sqrt':
            currentInput += 'Math.sqrt(';
            break;
          case 'cbrt':
            currentInput += 'Math.cbrt(';
            break;
          case 'nth_root':
            currentInput += 'root(';
            break;
          case 'x_sq':
            currentInput += '**2';
            break;
          case 'x_cub':
            currentInput += '**3';
            break;
          case 'pow_y':
            currentInput += '**';
            break;
          case 'pi':
            currentInput += 'Math.PI';
            break;
          case 'e':
            currentInput += 'Math.E';
            break;
          case 'fact':
            currentInput += '!';
            break;
          case 'percent':
            currentInput = currentInput.replace(/(\d+(\.\d+)?)%$/, (match, p1) => `*(${p1}/100)`);
            break;
          case 'm_add':
            try {
              memory += eval(currentInput);
              currentInput = memory.toString();
              historyDisplay.textContent = 'M+ Added';
            } catch (e) {
              historyDisplay.textContent = 'Error';
            }
            break;
          case 'm_sub':
            try {
              memory -= eval(currentInput);
              currentInput = memory.toString();
              historyDisplay.textContent = 'M- Subtracted';
            } catch (e) {
              historyDisplay.textContent = 'Error';
            }
            break;
          case 'm_rec':
            currentInput += memory;
            break;
          case 'm_clear':
            memory = 0;
            historyDisplay.textContent = 'Memory Cleared';
            break;
        }
      }
      resultDisplay.textContent = currentInput || '0';
    }

    // Event listener for button clicks
    buttonsGrid.addEventListener('click', (e) => {
      const button = e.target.closest('.btn');
      if (!button) return;
      const value = button.dataset.value;
      const func = button.dataset.function;

      // Determine input based on data attributes
      const input = value || func;
      handleInput(input);
    });
    
    // Function to evaluate the expression safely and handle errors
    function evaluateExpression() {
      try {
        historyDisplay.textContent = currentInput;
        let expression = currentInput;

        // Safely replace functions and constants with their JavaScript equivalents
        expression = expression.replace(/sin\(([^)]+)\)/g, 'Math.sin(toRad($1))');
        expression = expression.replace(/asin\(([^)]+)\)/g, 'toDeg(Math.asin($1))');
        expression = expression.replace(/cos\(([^)]+)\)/g, 'Math.cos(toRad($1))');
        expression = expression.replace(/acos\(([^)]+)\)/g, 'toDeg(Math.acos($1))');
        expression = expression.replace(/tan\(([^)]+)\)/g, 'Math.tan(toRad($1))');
        expression = expression.replace(/atan\(([^)]+)\)/g, 'toDeg(Math.atan($1))');
        expression = expression.replace(/log\(([^)]+)\)/g, 'Math.log10($1)');
        expression = expression.replace(/ln\(([^)]+)\)/g, 'Math.log($1)');
        expression = expression.replace(/sqrt\(([^)]+)\)/g, 'Math.sqrt($1)');
        expression = expression.replace(/cbrt\(([^)]+)\)/g, 'Math.cbrt($1)');
        expression = expression.replace(/(\d+)!/g, 'fact($1)');
        expression = expression.replace(/(\d+)\*\*2/g, 'Math.pow($1, 2)');
        expression = expression.replace(/(\d+)\*\*3/g, 'Math.pow($1, 3)');
        expression = expression.replace(/(\d+)\*\*(\-?\(?[\d\.]+\)?)?/g, 'Math.pow($1,$2)');
        expression = expression.replace(/root\(([^,]+),([^)]+)\)/g, 'Math.pow($2, 1/$1)');

        let calculatedResult = eval(expression);

        if (calculatedResult === Infinity || calculatedResult === -Infinity || isNaN(calculatedResult)) {
          throw new Error('Invalid input');
        }

        resultDisplay.textContent = calculatedResult;
        currentInput = calculatedResult.toString();

      } catch (error) {
        resultDisplay.textContent = 'Error';
        historyDisplay.textContent = 'Invalid Expression';
        currentInput = '';
        console.error('Calculation error:', error);
      }
    }
    
    // 3D Butterfly Logic
    window.onload = function () {
        const scene = new THREE.Scene();
        const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
        const renderer = new THREE.WebGLRenderer({ canvas: document.getElementById('three-canvas'), alpha: true, antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);

        // Create the butterfly group
        const butterfly = new THREE.Group();

        // Body (Cylinder)
        const bodyGeometry = new THREE.CylinderGeometry(0.15, 0.15, 1, 8);
        const bodyMaterial = new THREE.MeshLambertMaterial({ color: 0x8B4513 });
        const body = new THREE.Mesh(bodyGeometry, bodyMaterial);
        butterfly.add(body);

        // Left Wings (Box)
        const wingGeometry = new THREE.BoxGeometry(1.5, 1, 0.1);
        const wingMaterial = new THREE.MeshLambertMaterial({ color: 0xffa500 });
        const leftWing1 = new THREE.Mesh(wingGeometry, wingMaterial);
        leftWing1.position.set(-0.75, 0.25, 0);
        const leftWing2 = new THREE.Mesh(wingGeometry, wingMaterial);
        leftWing2.position.set(-0.75, -0.25, 0);
        
        const leftWingsGroup = new THREE.Group();
        leftWingsGroup.add(leftWing1);
        leftWingsGroup.add(leftWing2);
        leftWingsGroup.position.x = -0.25;
        leftWingsGroup.rotation.y = Math.PI / 2;
        butterfly.add(leftWingsGroup);

        // Right Wings (Box)
        const rightWing1 = new THREE.Mesh(wingGeometry, wingMaterial);
        rightWing1.position.set(0.75, 0.25, 0);
        const rightWing2 = new THREE.Mesh(wingGeometry, wingMaterial);
        rightWing2.position.set(0.75, -0.25, 0);

        const rightWingsGroup = new THREE.Group();
        rightWingsGroup.add(rightWing1);
        rightWingsGroup.add(rightWing2);
        rightWingsGroup.position.x = 0.25;
        rightWingsGroup.rotation.y = -Math.PI / 2;
        butterfly.add(rightWingsGroup);

        // Position and scale the butterfly
        butterfly.rotation.y = Math.PI / 2;
        butterfly.position.set(0, 0, -20);
        butterfly.scale.set(0.5, 0.5, 0.5);
        scene.add(butterfly);

        // Lighting
        const ambientLight = new THREE.AmbientLight(0x404040, 5);
        scene.add(ambientLight);
        const directionalLight = new THREE.DirectionalLight(0xffffff, 5);
        directionalLight.position.set(5, 5, 5);
        scene.add(directionalLight);

        camera.position.z = 5;

        // Animation loop
        const animate = () => {
            requestAnimationFrame(animate);

            // Make the wings flap
            const wingFlap = Math.sin(Date.now() * 0.005) * Math.PI / 6;
            leftWingsGroup.rotation.y = Math.PI / 2 + wingFlap;
            rightWingsGroup.rotation.y = -Math.PI / 2 - wingFlap;

            // Make the butterfly fly
            butterfly.position.z += 0.05;
            if (butterfly.position.z > 5) {
                butterfly.position.z = -20;
                butterfly.position.x = (Math.random() - 0.5) * 10;
                butterfly.position.y = (Math.random() - 0.5) * 10;
            }

            renderer.render(scene, camera);
        };

        // Handle window resizing
        window.addEventListener('resize', () => {
            const width = window.innerWidth;
            const height = window.innerHeight;
            renderer.setSize(width, height);
            camera.aspect = width / height;
            camera.updateProjectionMatrix();
        });

        animate();
    };
  </script>
</body>

</html>
